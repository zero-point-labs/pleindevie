# 🔧 Environment Variables Setup

## Quick Setup Steps

### 1. Copy the Template
```bash
cp env.template .env.local
```

### 2. Get Your Appwrite Values

**Go to your Appwrite Console:**
1. **Endpoint**: Use the one from your region (e.g., `https://fra.cloud.appwrite.io/v1`)
2. **Project ID**: Copy from your project dashboard
3. **API Key**: Create one with these permissions:
   - `databases.read`
   - `databases.write`
   - `collections.read`
   - `collections.write`
   - `attributes.read`
   - `attributes.write`
   - `indexes.read`
   - `indexes.write`
   - `documents.read`
   - `documents.write`

### 3. Fill in .env.local

```env
# Appwrite Configuration
NEXT_PUBLIC_APPWRITE_ENDPOINT=https://fra.cloud.appwrite.io/v1
NEXT_PUBLIC_APPWRITE_PROJECT_ID=688638ef0037975d2a27
NEXT_PUBLIC_APPWRITE_DATABASE_ID=
NEXT_PUBLIC_APPWRITE_LEADS_COLLECTION_ID=

# Appwrite API Key (for setup script only - keep this secure)
APPWRITE_API_KEY=standard_3b233324dc208e17acdd6f5f0d8a74ab6d8dfae759f3bc351127dbbb29eec2c52835e6df4edd782175094598f2e8d2cbc18317206bffc9380f6b8bba218ffc1273e70183c6a759c325ad64aff4e7f3d875a98beafcb1cde5958b79c1e8718e9a6a59daf651cfc33676e7fa5c5847e8698b1d0bfb09173ce6cd53e5a7a7195183

# n8n Webhook Configuration (add after setting up n8n)
NEXT_PUBLIC_N8N_WEBHOOK_URL=

# Optional: External Services
WEBHOOK_URL=
EMAIL_SERVICE_URL=
ADMIN_EMAIL=admin@example.com
```

### 4. Run the Setup Script
```bash
npm run setup:appwrite
```

The script will automatically:
- ✅ Create the database
- ✅ Create the leads collection  
- ✅ Set up all attributes and permissions
- ✅ Fill in the missing DATABASE_ID and COLLECTION_ID in your .env.local

### 5. Set Up Admin Authentication

**⚠️ IMPORTANT: Admin access now uses Appwrite authentication instead of a hardcoded password.**

1. **Go to your Appwrite Console → Auth → Users**
2. **Create a new user** with your admin email and password
3. **No signup page is available** - only you can create admin users from the Appwrite dashboard

**To access the admin panel:**
- Go to `/admin`
- Use your Appwrite user credentials (email/password)
- Only users created in the Appwrite dashboard can access the admin

### 6. Validate Everything Works
```bash
npm run validate:setup
```

## Important Notes

- **Keep your API key secure** - don't commit it to git
- **Database/Collection IDs** will be auto-generated by the setup script
- **n8n webhook URL** can be added later when you set up the workflow
- **Admin authentication** is now managed through Appwrite - no more hardcoded passwords

## What Gets Created

The setup script creates:
```
Database: "Renovation Leads DB"
├── Collection: "leads"
    ├── name (String, required)
    ├── email (String, required)  
    ├── phone (String, required)
    ├── projectType (Enum: Kitchen, Bathroom, etc.)
    ├── budget (Enum: $25k-$50k, $50k-$100k, etc.)
    ├── timeline (Enum: ASAP, 1-3 months, etc.)
    ├── message (String, optional)
    ├── termsAccepted (Boolean, required)
    ├── marketingConsent (Boolean, required)
    ├── status (Enum: new, contacted, qualified, closed)
    └── timestamp (String, required)
```

## Admin Access

**Previous Setup (Deprecated):**
~~Admin used a hardcoded password: "Renovation123"~~

**New Setup (Secure):**
- Admin authentication through Appwrite
- Create admin users in Appwrite Console → Auth → Users
- Login with email/password at `/admin`
- Secure session management with automatic logout

## Troubleshooting

**"API key permissions"** → Make sure your API key has all the required permissions listed above

**"Project not found"** → Double-check your Project ID

**"Endpoint not accessible"** → Verify your endpoint URL (different regions have different URLs)

**"Cannot login to admin"** → Make sure you've created a user in Appwrite Console → Auth → Users

**"Authentication error"** → Check that your Appwrite project has Auth enabled and your credentials are correct

That's it! Your Appwrite integration will be ready to use. 🚀 